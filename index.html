<html ng-app='helpdesk'>
<head>
    <title>Are you in trouble?</title>
    <meta charset="utf-8"/>
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet"/>
    <link href="bootstrap/css/bootstrap-theme.css" rel="stylesheet"/>

    <link href="css/main.css" rel="stylesheet"/>
    <link href="css/login.css" rel="stylesheet"/>
    <link href="css/task.css" rel="stylesheet"/>
    <link href="css/filter.css" rel="stylesheet"/>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/libs/jquery.js"></script>
    <script src="js/libs/angular.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/helpers/templatehelper.js"></script>
    <script src="js/helpers/interface.js"></script>
    <script src="js/helpers/eventemitter.js"></script>
    <script src="js/services/service.js"></script>
    <script src="js/services/networkservice.js"></script>
    <script src="js/services/filtersprovider.js"></script>
    <script src="js/services/subdepartprovider.js"></script>
    <script src="js/services/universitydepservice.js"></script>
    <script src="js/services/profileprovider.js"></script>
    <script src="js/controllers/profilecontroller.js"></script>
    <script src="js/scopes/taskscope.js"></script>
    <script src="js/controllers/taskscontroller.js"></script>
    <script src="js/controllers/filterscontroller.js"></script>
    <script src="js/validator.js"></script>
    <script src="js/app.js"></script>
</head>
<body ng-controller="tasksCntrl">
<nav class="navbar navbar-default navbar-fixed-top special" role="navigation">
    <div class="navbar-text tasks-view" ng-class = "{ hidden : profile[0].role != 'department chief' }"><div class="glyphicon glyphicon-align-justify"></div> Заявки</div>
    <div class="navbar-text profiles-view" ng-class = "{ hidden : profile[0].role != 'department chief' }"><div class="glyphicon glyphicon-user"></div> Реестры</div>
    <div class="navbar-text table-mode"><div class="glyphicon glyphicon-th-list"></div> Режим таблицы</div>
    <div class="navbar-text grid-mode"><div class="glyphicon glyphicon-th"></div> Режим сетки</div>
    <div class="navbar-right">
        <div ng-class = "{ hidden : profile[0].role != 'client' && profile[0].role != 'department chief' }" class = "glyphicon glyphicon-edit add-new-task-button"></div>
        <div class="navbar-text logout">Выйти из системы</div>
    </div>

</nav>

<div ng-controller = 'filterCntrl' class="filters">
    <div class='open-filter-button'></div>
    <input type="text" ng-model="filterName" style="margin-left: 10px"/>
    <h6 ng-class = "{ hidden : profile[0].role == 'client' }">Кафедры</h6>
    <ul>
        <li ng-repeat='filterItem in filters.universityDep | filter : filterName ' ng-style="myStyle"
            ng-click="events.click($event)" data-section = 'universityDep' data-id = '{{ filterItem.id }}'> <!-- events.click($event) -->
            <span class="color-label" ng-style="{ background : filterItem.color }"></span> {{ filterItem.name }}
        </li>
    </ul>

    <h6>Тип заявки</h6>
    <ul>
        <li ng-repeat='filterItem in filters.taskTypes | filter : filterName ' ng-style="myStyle"
            ng-click="events.click($event)" data-section = 'taskTypes' data-id = '{{ filterItem.id }}'> <!-- events.click($event) -->
            <span class="color-label" ng-style="{ background : filterItem.color }"></span> {{ filterItem.name }}
        </li>
    </ul>
</div>

<table class="table table-hover table-view">
    <thead>
        <th>#</th>
        <th>Заявка</th>
        <th>Комментарии</th>
        <th>Назначены</th>
    </thead>
    <tbody>
        <tr ng-repeat="task in tasks" ng-click = 'openTask(task.id)'>
            <td>{{ task.id }}</td>
            <td style="max-width: 650px">{{ task.content.slice(0,120) }}</td>
            <td><span class = "glyphicon glyphicon-comment"></span> {{ task.commentCount }}</td>
            <td><span class = "glyphicon glyphicon-user"></span> {{ task.helperIds.length }}</td>
        </tr>
    </tbody>
</table>

<table class = "table table-hover profiles" style="display: none;" ng-controller = "ProfilesCtrl">
    <thead>
        <th>#</th>
        <th>Имя</th>
        <th>Отдел</th>
        <th>Факультет</th>
    </thead>
    <tbody>
        <tr ng-repeat="profile in profiles" ng-click="openProfile(profile.id)">
            <td>{{ profile.id }}</td>
            <td>{{ profile.displayName }}</td>
            <td>{{ getSubDep(profile.subdepartmentId) }}</td>
            <td>{{ getUniDep(profile.universityDepartmentId) }}</td>
        </tr>
    </tbody>
</table>

<div class="task-list" style="display: none">
    <section class='task' ng-repeat='task in tasks'>
        <header></header>
        <!--<h3>{{ task.title }}</h3>-->
        <div> {{ task.content.slice(0, 120) }}</div>
        <div class='button-section view' ng-click = 'openTask(task.id)'>
            <div class="glyphicon glyphicon-eye-open"></div>
            <div>Показать</div>
        </div>
        <div class='button-section comments'>
            <div class="glyphicon glyphicon-comment"></div>
            <div>{{ task.commentCount }}</div>
        </div>
        <div class='button-section onit'>
            <div class="glyphicon glyphicon-user"></div>
            <div>{{ task.helperIds.length }}</div>
        </div>
    </section>
</div>

<div>
    <section class="task new-task" ng-class = '{ lite : profile[0].role != "department chief" }'>
        <header>
            <div class = "glyphicon glyphicon-edit add-new-task-inline"></div>
            <h4>НОВАЯ ЗАЯВКА</h4>
            <div class = "glyphicon glyphicon-remove-circle close-button"></div>
        </header>
        <textarea></textarea>
        <p ng-class = '{ hidden : profile[0].role != "department chief" }'>Подразделение: <select ng-model = 'selectedUniDep' ng-options = 'uni.id as uni.name for uni in filters.universityDep'></select>
        <p ng-class = '{ hidden : profile[0].role != "department chief" }'>Отдел:<select ng-model = 'selectedSub' ng-options = 'uni.id as uni.name for uni in subDeps'></select>
        <p>Тип заявки: <select ng-model = 'selectedTaskType' ng-options = 'uni.id as uni.name for uni in filters.taskTypes'></select>
        <div class = 'button-save' ng-click = 'save()'>Сохранить</div>
    </section>

    <section class="task opened-task"> </section>
    <section class="opened-profile"> </section>
    <div class="blackout"></div>
</div>
</body>
</html>
